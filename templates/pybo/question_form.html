{% extends 'base.html' %}

{% block content %}
<style>
.image-preview {
            max-width : 300px;
            max-height : 300px;

            margin-top : 10px;
            margin-left : 100px;
            display: none;
        }
 #drop-zone {
            border: 2px dashed #007bff;
            padding: 20px;
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
   }
 #drop-zone.hover {
            background-color: #f0f0f0;
  }
 #file-name {
        margin-top: 20px;
        font-size: 16px;
        color: #333;
 }
 </style>

<div class="container">
    <h5 class="my-3 border-bottom pb-2">질문 등록</h5>

    <form method="post" class="post-form my-3" enctype="multipart/form-data">
        {% csrf_token %}

        {% comment %} 오류 표시 Start {% endcomment %}
        {% if form.errors %}
            <div class="alert alert-danger" role="alert">
                {% for field in form %}
                    {% if field.errors %}
                        <strong>{{ field.label }}</strong>
                        {{ field.errors }}
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
        {% comment %} 오류 표시 End {% endcomment %}

        <div class="form-group">
            <label for="subject">제목</label>
            <input type="text" name="{{ form.subject.name }}" id="subject" class="form-control" value="{{ form.subject.value|default_if_none:'' }}">
        </div>

<!--        <div class="form-group">-->
<!--            <label for="content">내용</label>-->
<!--            <textarea name="content" id="content" class="form-control" rows="10">{{ form.content.value|default_if_none:'' }}</textarea>-->
<!--        </div>-->
          <p>
            <label for="id_image">업로드 이미지:</label>
            <input type="file" name="image" id="id_image" accept="image/*" value="{{ form.content.value|default_if_none:'' }}">
         </p>

          <div>
        <div id="drop-zone">파일을 여기에 드래그 앤 드롭 하세요</div>
            {{ form.file.label_tag }}<br>
            {{ form.file }}<br>
            {{ form.file.errors }}
        </div>
          <img id="image-preview" src="" alt="">


        <button type="submit" class="btn btn-primary">저장하기</button>
    </form>
</div>

<script>
         document.addEventListener('DOMContentLoaded', function() {


            var dropZone       = document.getElementById('drop-zone');
            var fileNameDisplay = document.getElementById('file-name');

            const imageInput = document.querySelector('input[name="image"]');
            const imagePreview = document.createElement('img');
            imagePreview.classList.add('image-preview');
            document.body.appendChild(imagePreview);


             dropZone.addEventListener('dragover', function(event) {
                event.preventDefault();
                event.stopPropagation();
                dropZone.classList.add('hover');
            });

            dropZone.addEventListener('dragleave', function(event) {
                event.preventDefault();
                event.stopPropagation();
                dropZone.classList.remove('hover');
            });

             dropZone.addEventListener('drop', function(event) {
                event.preventDefault();
                event.stopPropagation();
                dropZone.classList.remove('hover');

                var files = event.dataTransfer.files; // 드롭된 파일 가져오기

                //file input이 있는지

                console.error("drop message")
                if (files.length > 0 ) {
                    var file = files[0];

                    if( file && file.type.startsWith('image/')){
                        const reader = new FileReader();
                        reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                        console.log("image loaded")
                        };
                        reader.readAsDataURL(file);
                    } else {
                        console.error("not image")
                        imagePreview.src = '';
                    }
                }else
                {
                    console.error("no files dropped")
                }
            });


            imageInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {

                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.src = '';
                }
            });



        });
</script>
{% endblock %}
